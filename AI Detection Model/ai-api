from flask import Flask, request, jsonify
from PIL import Image
#from app import predict_diseases
from werkzeug.utils import secure_filename
import os
import matplotlib.pyplot as plt

app = Flask(__name__)

UPLOAD_FOLDER = 'uploads'
if not os.path.exists(UPLOAD_FOLDER):
    os.makedirs(UPLOAD_FOLDER)
app.config['UPLOAD_FOLDER'] = UPLOAD_FOLDER


@app.route('/')
def hello_world():
    print("i am here")
    return 'Hello, World!'


@app.route('/predict', methods=['POST'])
def predict():
    print("i am here ")
    if 'image' not in request.files:
        return jsonify({'error': 'No image part in the request'}), 400
    
    file = request.files['image']
    print(file,"i am here 1")
    if file.filename == '':
        return jsonify({'error': 'No image selected for uploading'}), 400

    if file:
        print("i am here 2")
        filename = secure_filename(file.filename)
        filepath = os.path.join(app.config['UPLOAD_FOLDER'], filename)
        file.save(filepath)

        # Open the image file
        image = Image.open(filepath)
        plt.show(image)
        # Predict the disease
        #predicted_class_name, probability = predict_diseases(image)

        # Remove the file after processing
        #os.remove(filepath)

        return jsonify({'result': "predicted_class_name", 'probability': "probability"})
    

if __name__ == '__main__':
    app.run(debug=True, port=8080)
